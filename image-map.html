<!DOCTYPE html>

<html lang="en">
   <head>    
      <title>Free Online Image Map Generator</title>          

      <link rel="stylesheet" href="./image-map-asset/app.min.css">
      <link rel="stylesheet" href="./image-map-asset/css.css">
      <link rel="stylesheet" href="./image-map-asset/bootstrap.min.css">
      <script type="text/javascript" async="" src="./image-map-asset/fc.js"></script>
      <script src="./image-map-asset/jquery.min.js"></script>
      <script src="./image-map-asset/bootstrap.min.js"></script>
      <script src="https://content-us.goacoustic.com/auth/ibm-wch-ui-extensions.js"></script>
      <style type="text/css">@keyframes fcmodal__overlay_in{from{opacity:0}to{opacity:1}}@keyframes fcmodal__overlay_out{from{opacity:1}to{opacity:0}}@keyframes fcmodal__container_in{0%,50%{opacity:0;transform:translate3d(0,3px,0) scale(.99)}100%{opacity:1;transform:translate3d(0,0,0) scale(1)}}@keyframes fcmodal__container_out{from{opacity:1;transform:translate3d(0,0,0) scale(1)}to{opacity:0;transform:translate3d(0,3px,0) scale(.99)}}@keyframes loadAnimate{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fcpbl{text-decoration:none;display:block;font-size:16px;max-width:100%;padding:.5em;text-align:center}.fc__pbc{padding-top:.5em;display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;font-size:15px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;justify-content:center;max-width:100%;font-weight:400;white-space:pre;text-transform:lowercase;transition:opacity 250ms;border:0!important;font-weight:400!important}.fc__pbc>a,.fc__pbc>span{font-weight:400!important;padding:.1em 0!important;font-style:none;text-decoration:none}.fc__pbc>a:hover{opacity:1}.fc__pbc .fc__l{-webkit-text-stroke:.65px;color:#3073ed;position:relative;display:inline-flex}.fc__pbc .fc__pbl{padding:.5em;color:#43494c}.fcmodal__loader{margin:0;position:absolute;text-indent:-9999em;border-top:2px solid #fff;border-right:2px solid #fff;border-bottom:2px solid #fff;border-left:2px solid transparent;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:loadAnimate 1.1s infinite linear;animation:loadAnimate 1.1s infinite linear;width:24px;height:24px;border-radius:100%}.fc__inline_container{width:100%}.fc__inline_container .fc__iframe{border-radius:4px;box-shadow:0 0 0 .5px rgba(0,0,0,.12),0 0 3px rgba(0,0,0,.1)}.fc__inline_container .fc__iframe.remove-frame{box-shadow:none}.fc__inline_container .fc__iframe.fc__no_border{box-shadow:none;border-radius:initial}.fc__iframe{box-shadow:none;border-radius:4px;width:100%;max-width:100%;will-change:height}.fc__iframe.fc__inline{opacity:0;transform:translate3d(0,1px,0);will-change:opacity,transform,height;transition:opacity 250ms ease-out,transform 250ms ease-out,height 20ms linear}.fc__iframe.fc__inline.fc__visible{opacity:1;transform:translate3d(0,0,0)}.fcmodal__toggle{display:none}.fcmodal__toggle.fcmodal__is_open{display:flex;z-index:999997}.fcmodal__overlay{padding:1.75rem;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(100,105,110,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;transition:all .4s linear;overflow:auto;will-change:opacity;z-index:999998}.fcmodal__overlay .fc__iframe{box-shadow:none;border-radius:0;animation:none}.fcmodal__overlay .fcmodal__close{display:none}.fcmodal__overlay .fc__pbc{font-size:16px;animation:fcmodal__overlay_in 250ms cubic-bezier(.1,0,.7,1);width:100%;max-width:90vw;padding:.8em 0 0 0;font-weight:500;min-height:40px;position:relative}.fcmodal__overlay .fc__pbc .fc__l,.fcmodal__overlay .fc__pbc .fc__pbl,.fcmodal__overlay .fc__pbc .fc__ral,.fcmodal__overlay .fc__pbc .fc__rat{color:#fff;opacity:1}.fcmodal__overlay .fc__pbc .fc__rat{opacity:.85}.fcmodal__overlay .fc__pbc .fc__l{color:#fff;-webkit-text-stroke:.65px #fff}.fcmodal__toggle[aria-hidden=false] .fcmodal__overlay{animation:fcmodal__overlay_in 250ms ease-out}.fcmodal__toggle[aria-hidden=true] .fcmodal__overlay{animation:fcmodal__overlay_out 250ms ease-out}.fcmodal__container{flex-wrap:wrap;max-width:90vw;overflow-y:auto;box-sizing:border-box;will-change:transform;width:200px;display:none;justify-content:center;align-items:flex-start;box-shadow:0 0 1px #000a14,0 3px 8px rgba(0,10,20,.4);border-radius:4px;z-index:999999;background-color:transparent;flex:1;visibility:hidden}.fcmodal__container.remove-frame{box-shadow:none}.fcmodal__toggle[aria-hidden=false] .fcmodal__container.fcmodal__container__visible{visibility:visible;animation:fcmodal__container_in 250ms cubic-bezier(.1,0,.7,1)}.fcmodal__toggle[aria-hidden=true] .fcmodal__container{animation:fcmodal__container_out 250ms cubic-bezier(.1,0,.7,1)}@media (min-width:871px){.fcmodal__close{display:none!important}}@media print,screen and (max-device-width:870px){.fcmodal__overlay{padding:0 1.75rem}.fcmodal__overlay .fcmodal__container{max-width:100%;max-height:80vh;width:100vw}.fcmodal__overlay .fc__pbc{animation:fcmodal__container_in 250ms cubic-bezier(.1,0,.7,1);padding:0;height:10vh;font-size:15px}.fcmodal__overlay .fcmodal__close{animation:fcmodal__container_in 250ms cubic-bezier(.1,0,.7,1);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;color:#fff;-webkit-text-stroke:.5px #fff;font-size:14px;font-weight:500;letter-spacing:.75px;text-transform:uppercase;display:none;align-items:center;justify-content:center;height:10vh}}</style>
      <style>
         .flipX video::-webkit-media-text-track-display {
         transform: matrix(-1, 0, 0, 1, 0, 0) !important;
         }
         .flipXY video::-webkit-media-text-track-display {
         transform: matrix(-1, 0, 0, -1, 0, 0) !important;
         }
         .flipXYX video::-webkit-media-text-track-display {
         transform: matrix(1, 0, 0, -1, 0, 0) !important;
         }
      </style>
      <script>
         wchUIExt.requestResizeFrame(1500);
         function saveMap() {
            var mapResult = document.getElementById("modal-code-result").value;

            wchUIExt.getDefinition().then((definition) => {
                if (definition.elementType === "group") {
                    wchUIExt.setElement({
                        elementType: "group",
                        typeRef: definition.typeRef,
                        value: {
                            "imageMapWithCoordinates": {
                                elementType: "text",
                                value: document.getElementById("modal-code-result").value,
                            }
                        }
                    });
                    alert("Value Saved");
                } else {
                    wchUIExt.setElement({
                        elementType: "text",
                        value: document.getElementById("modal-code-result").value,
                    });
                    alert("Value Saved");
                }
            });           
          }

          function init()
          {
             console.log("reading value from acoustic");
             //var result = '<map name="image-map">'
              // +'<area target="" alt="" title="shape1" opacity="50" onclickcolor="#25f447"  onhovercolor="#b95050" color="#7428e6" href="" coords="408,205,338,278" shape="rect">'
              // +'<area target="" alt="" title="shape2" opacity="70" color="#25f447" onclickcolor="#b95050" onhovercolor="#7428e6" href="" coords="161,249,127,323,229,350,277,297,271,244,255,213,221,178,181,176,110,190,86,226,83,253,83,271,88,291,97,304,106,313,117,319,121,322" shape="poly">'
              // +'<area target="" alt="shape3" title="shape3" opacity="78" color="#cb5757" onclickcolor="#84f056" onhovercolor="#90d0bd" href="" coords="397,415,427,366" shape="rect">'
              // +'</map>'
              // +'<img id="50ebcabd-a44e-40eb-916c-dee6c100824f" name="stage-1-dorsal-motor-x-nucleus.png">'
              ReadAcousticField();
          }

          function ReadAcousticField()
          {
            wchUIExt.getDefinition().then((definition) => {
               wchUIExt.getElement().then((element) => {
                   if (definition.elementType === "group") {
                       if (element.value["imageMapWithCoordinates"]) {
                           var map = element.value["imageMapWithCoordinates"];
                           console.log(map);
                          
                       }
                   } else {
                       if (element.value) {
                           var elementValue = element.value;    
                           document.getElementById("result-saved-from-acoustic").value = elementValue;
                        }
                   }
               });
               // Disable when published
               if (definition.disabled) {
                  
               }
           });
          }


          function offset(el) {
            var rect = el.getBoundingClientRect(),
            scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
            scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            return { top: rect.top + scrollTop, left: rect.left + scrollLeft }
        }

          function drawImage()
          {
            var savedResult = document.getElementById("result-saved-from-acoustic").value;
            var newAreas = [];
            if(savedResult.length > 0)
            {              
               $(".image-map-body-container-kki").attr('styles','overflow:hidden');
               var mapString = savedResult?.split("</map>")?.length > 0 ? savedResult?.split("</map>")[0] : "";
               var areas = mapString.split('<area');

               for (var areaIndex = 0; areaIndex < areas.length; areaIndex ++)
               {
                   var area = "<area" + areas[areaIndex];
                   var areaElement = new DOMParser().parseFromString(area, "text/xml");      
                   newAreas.push(areaElement.getElementsByTagName("area")[0]);
               };
            }                    
    
            
            console.log(newAreas);
            var areaList=[];
            for (var index = 0; index < newAreas.length; index ++)
            {
               var area={};
               if(newAreas[index] != null && typeof newAreas[index] != undefined)
               {
                  area.shape = newAreas[index].getAttribute("shape");
                  area.color = newAreas[index].getAttribute("color");
                  area.colorOnHover = newAreas[index].getAttribute("onhovercolor");
                  area.colorOnClick = newAreas[index].getAttribute("onclickcolor");
                  area.coords = newAreas[index].getAttribute("coords");
                  area.title = newAreas[index].getAttribute("title");
                  area.opacity = newAreas[index].getAttribute("opacity");
                  areaList.push(area);                  
               } 
            }            

            var imageSvg = document.querySelector('.image-mapper-svg');
            var divOffset = offset(imageSvg);
            

            for (var aIndex = 0; aIndex < areaList.length; aIndex ++)
            {
               var activeSelector = 'input[name="im['+aIndex+'][active]"]';
               var colorSelector = 'input[name="im['+aIndex+'][color]"]';
               var shapeSelector = 'select[name="im['+aIndex+'][shape]"]';
               var onhoverSelector = 'input[name="im['+aIndex+'][onhovercolor]"]';
               var onclickSelector = 'input[name="im['+aIndex+'][onclickcolor]"]';
               var opacitySelector = 'input[name="im['+aIndex+'][opacity]"]';
               var titleSelector = 'input[name="im['+aIndex+'][title]"]';

               $(activeSelector).checked = true;
               $(activeSelector).trigger("change");
               $(colorSelector).val(areaList[aIndex].color);
               $(colorSelector).trigger("change");
               $(shapeSelector).val(areaList[aIndex].shape);
               $(shapeSelector).trigger("change");
               $(onhoverSelector).val(areaList[aIndex].colorOnHover);
               $(onhoverSelector).trigger("change");
               $(onclickSelector).val(areaList[aIndex].colorOnClick);
               $(onclickSelector).trigger("change");
               $(opacitySelector).val(areaList[aIndex].opacity);
               $(opacitySelector).trigger("change");
               $(titleSelector).val (areaList[aIndex].title);
               $(titleSelector).trigger("change");
               createPoints(areaList[aIndex],divOffset.left, divOffset.top);
               $(".add-row").trigger("click");
            }

            var activeSelectorNext = 'input[name="im['+areaList.length +'][active]"]';
            $(activeSelectorNext).checked = true;
            $(activeSelectorNext).trigger("change"); 
            
            $(".image-map-body-container-kki").attr('styles','overflow:auto');          


          }

          var myX, myY, xyOn, myMouseX, myMouseY, offsetX, offsetY,pageX,pageY,screenX,screenY;
          function getXYPosition(e){
            myMouseX=(e).clientX;
            myMouseY=(e).clientY;
            offsetX = (e).offsetX;
            offsetY = (e).offsetY;
            pageX = (e).pageX;
            pageY = (e).pageY;
            screenX = (e).screenX;
            screenY = (e).screenY;

            console.log(e);
            console.log("clientX is " + myMouseX + "\nclientY is " + myMouseY + "\n offset x "+ offsetX+"\n offset y "+offsetY
            +"\n Screen X is "+screenX+"\n screen Y is "+ screenY +"\n pageX is "+pageX+"\n pageY is "+pageY);            
            }


            function createPoints(area, xOffset, yOffset)
            {
               
               var coords = area.coords.split(',');
               var points = [];
               
               //if rectangle or polygon
               if(coords.length % 2 == 0 )
               {

                  for(var index = 0; index < coords.length; index = index + 2 )
                  {
                     var point = {};
                     if(index + 1 > coords.length)
                     {
                        break;
                     }                  
                     point.x = coords[index];
                     point.y = coords[index+1];
                     points.push(point);  
                  }
               }
         
               console.log(xOffset, yOffset);

               for(var pointIndex = 0; pointIndex < points.length; pointIndex++)
               {
                  var pointerEvent = new PointerEvent({
                     'offsetX' : parseInt(points[pointIndex].x) + xOffset,
                     'offsetY' : parseInt(points[pointIndex].y)  + yOffset,
                     'pointerType': "mouse"             
                  });
                  //console.log(ev1);

                  //console.log("X is "+ points[pointIndex].x + " Y is "+ points[pointIndex].y);

                  var mainEvent1 = new MouseEvent('click', {
                     'view': window,
                     'bubbles': true,
                     'cancelable': true,
                     'currentTarget':'div#image-map.image-mapper',
                     'delegateTarget':'div#image-map.image-mapper',
                     'clientX':  parseInt(points[pointIndex].x) + xOffset,
                     'clientY': parseInt(points[pointIndex].y)  + yOffset,
                     'originalEvent': pointerEvent,
                     'pageX':parseInt(points[pointIndex].x) + xOffset,
                     'pageY':parseInt(points[pointIndex].y)  + yOffset,
                     'target': 'svg.image-mapper-svg',
                     'which': 1,

                  });

                  var component = document.getElementsByClassName('image-mapper-svg')[0];
                  component.dispatchEvent(mainEvent1);
                  
                 

               }             
               
            }         
          
      </script>
   </head>
   <body class="image-map-body-container-kki">
     
      <div class="container">
         <div class="row">
            <div class="col-md-12">               
               <div class="step">
                  <div style="margin-bottom:20px;">
                     <label for="image-id">Image Id:</label>
                     <input type="text" id="image-id" class="image-id-txt">
                  </div><div style="margin-bottom:20px;">
                     
                     <label for="image-id">Image name:</label>
                     <input type="text" id="image-name" class="image-name-txt" placeholder="include image extension">
                  </div>
                  <button type="button" class="btn btn-success btn-lg" id="image-mapper-upload">Load Image</button>
                  <input type="file" name="" id="image-mapper-file">
                  <span class="divider">                     
                  </div>
            </div>
         </div>
      </div>
      <div class="container toggle-content" style="display: none;">
         <div class="row">
            <div class="col-md-12">
               <div class="container">
                  <div class="row">
                     <div class="col-md-12" id="image-map-wrapper">
                        <div id="image-map-container">
                           <div id="image-map" style="max-width: 100%" class="image-mapper">
                              <img class="image-mapper-img">
                              <svg class="image-mapper-svg" style="width: 100%;"></svg>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <table class="table" id="image-mapper-table">
                  <thead>
                     <tr>
                        <th>Active</th>
                        <th>Shape</th>
                        <th>Color</th>
                        <th>On Hover Color</th>
                        <th>On Click Color</th>
                        <th>Opacity</th>
                        <th>Title</th>
                        <th>Target</th>                        
                        <th style="width: 25px"></th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td style="width: 65px">
                           <div class="control-label input-sm"><input type="radio" name="im[0][active]" value="1" checked="checked"></div>
                        </td>
                        <td>
                           <select name="im[0][shape]" class="form-control input-sm">
                              <option value="">---</option>
                              <option value="rect">Rect</option>
                              <option value="poly">Poly</option>
                              <option value="circle">Circle</option>
                           </select>
                        </td>
                        <td>
                           <input type="color" name="im[0][color]" value="" placeholder="Link" class="form-control input-sm">
                        </td>
                        <td>
                           <input type="color" name="im[0][onhovercolor]" value="" placeholder="Link" class="form-control input-sm">
                        </td>
                        <td>
                           <input type="color" name="im[0][onclickcolor]" value="" placeholder="Link" class="form-control input-sm">
                        </td>
                        <td>
                           <input type="number" name="im[0][opacity]" value="" placeholder="Opacity" class="form-control input-sm">
                        </td>
                        <td>
                           <input type="text" name="im[0][title]" value="" placeholder="Title" class="form-control input-sm">
                        </td>                        
                        <td>
                           <button class="btn btn-default btn-sm remove-row" name="im[0][remove]" value=""><span class="glyphicon glyphicon-remove"></span>
                           </button>
                        </td>
                     </tr>
                  </tbody>
                  <tfoot>
                     <tr>
                        <th colspan="6" style="text-align: right"><button type="button" class="btn btn-danger btn-sm add-row"><span class="glyphicon glyphicon-plus"></span> Add New Area</button></th>
                     </tr>
                  </tfoot>
               </table>
            </div>
         </div>
      </div>
      <div class="container toggle-content segment" style="display: none;">
         <div class="row">
            <div class="col-md-12" style="text-align: center"><button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#modal-code">Show Me The Code!</button>
            </div>
         </div>
      </div>      
      <div class="modal fade" id="image-mapper-load" tabindex="-1" role="dialog" aria-labelledby="image-mapper-load-label" aria-hidden="true">
         <div class="modal-dialog">
            <div class="modal-content" id="image-mapper-dialog">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h4 class="modal-title" id="image-mapper-load-label">Load Image from Website</h4>
               </div>
               <div class="modal-body">
                  <div class="input-group input-group-sm has-error">
                     <input type="text" value="" placeholder="http://..." id="image-mapper-url" class="form-control input-sm">
                     <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span></div>
               </div>
               <div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button> <button type="button" class="btn btn-primary" id="image-mapper-continue">Continue</button></div>
            </div>
         </div>
      </div>
      <div class="modal fade" id="modal-code" tabindex="-1" role="dialog" aria-labelledby="modal-code-label" aria-hidden="true">
         <div class="modal-dialog">
            <div class="modal-content" id="modal-code-dialog">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h4 class="modal-title" id="modal-code-label">Generated Image Map Output</h4>
               </div>
               <div class="modal-body">
                  <textarea class="form-control input-sm" readonly="readonly" id="modal-code-result" rows="10"></textarea>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-default" onclick="saveMap()">Save Map</button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
      <footer>
        <input type="hidden" id="result-saved-from-acoustic"></input>
      </footer>
      <script src="./image-map-asset/app.min.js"></script>
      <script>

        window.addEventListener('DOMContentLoaded', init);

        setTimeout(function () {
            (function($){ $(document).trigger('init'); })(jQuery);            
        }, 3000);

        setTimeout(function () {
         drawImage();           
         }, 5000);
       
         //document.onmouseup=getXYPosition;

      </script>
      
   </body>
</html>